#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔍 Running pre-commit checks..."

# 1. 先格式化，确保代码风格一致
echo "💅 Formatting code..."
npm run format

# 2. TypeScript 类型检查
echo "📝 Type checking..."
npm run type-check || {
  echo "❌ TypeScript type check failed"
  exit 1
}

# 3. ESLint 检查（自动修复错误，只阻止错误级别的失败）
echo "🔧 Linting and auto-fixing..."
npm run lint:fix || {
  echo "❌ ESLint auto-fix failed"
  exit 1
}

# 4. 再次格式化，确保 lint 修复后的代码格式正确
echo "💅 Final formatting check..."
npm run format

# 5. Lint-staged（只处理暂存的文件）
echo "🎯 Running lint-staged..."
npx lint-staged || {
  echo "❌ Lint-staged failed"
  exit 1
}

echo "✅ All checks passed!"