#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# 1. å…ˆæ ¼å¼åŒ–ï¼Œç¡®ä¿ä»£ç é£æ ¼ä¸€è‡´
echo "ğŸ’… Formatting code..."
npm run format

# 2. TypeScript ç±»å‹æ£€æŸ¥
echo "ğŸ“ Type checking..."
npm run type-check || {
  echo "âŒ TypeScript type check failed"
  exit 1
}

# 3. ESLint æ£€æŸ¥ï¼ˆè‡ªåŠ¨ä¿®å¤é”™è¯¯ï¼Œåªé˜»æ­¢é”™è¯¯çº§åˆ«çš„å¤±è´¥ï¼‰
echo "ğŸ”§ Linting and auto-fixing..."
npm run lint:fix || {
  echo "âŒ ESLint auto-fix failed"
  exit 1
}

# 4. å†æ¬¡æ ¼å¼åŒ–ï¼Œç¡®ä¿ lint ä¿®å¤åçš„ä»£ç æ ¼å¼æ­£ç¡®
echo "ğŸ’… Final formatting check..."
npm run format

# 5. Lint-stagedï¼ˆåªå¤„ç†æš‚å­˜çš„æ–‡ä»¶ï¼‰
echo "ğŸ¯ Running lint-staged..."
npx lint-staged || {
  echo "âŒ Lint-staged failed"
  exit 1
}

echo "âœ… All checks passed!"